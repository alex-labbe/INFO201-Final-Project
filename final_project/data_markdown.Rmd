---
title: "driver_data"
author: "Alexandre Labbe"
date: "2023-11-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(ggplot2)

drivers <- read_delim("../bad-drivers.csv") %>% filter(!State =="District of Columbia")
temperatures <- read_delim("../average-temperatures-by-state-2023.csv") %>% filter(!state =="District of Columbia") %>% select(state, AverageTemperatureF, AverageTemperatureAvgAnnualPrecipitationIn, AverageTemperatureAvgHighF, AverageTemperatureAvgLowF)
education <- read_delim("../educational-attainment-by-state-2023.csv") %>% filter(!state =="District of Columbia") %>% select(state, PercentHighSchoolOrHigher, PercentBachelorsOrHigher)
politics  <- read_delim("../political-parties-by-state-2023.csv")  %>% filter(!state =="District of Columbia") %>% select(state, PoliticalPartiesDemocratLeanDem, PoliticalPartiesRepublicanLeanRep, PoliticalPartiesNoLean)


names(education)[names(education) == 'state'] <- 'State'
names(temperatures)[names(temperatures) == 'state'] <- 'State'
names(politics)[names(politics) == 'state'] <- 'State'

drivers
temperatures
education

drivers <- merge(drivers, temperatures, by = "State")
drivers <- merge(drivers, education, by = "State")
drivers <- merge(drivers, politics, by = "State")
drivers
```


```{r}
drivers$party <- apply(drivers[, c("PoliticalPartiesDemocratLeanDem", "PoliticalPartiesRepublicanLeanRep", "PoliticalPartiesNoLean")], 1, function(row) {
  parties <- c("Democrat", "Republican", "NoLean")
  parties[which.max(row)]
})
drivers
```
lets start by seeing the relationship driver crashes per state
```{r}
state_vs_collisions <- ggplot(drivers, aes(x=State, y=`Number of drivers involved in fatal collisions per billion miles`)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
state_vs_collisions
```
we would like to know if there are relationships between other factors states have and see if that could be affecting these results.

first we wanted to see if the average temperature of the state is affecting this
```{r}
state_vs_collisions <- ggplot(drivers, aes(x=State, y=`Number of drivers involved in fatal collisions per billion miles`, fill=AverageTemperatureF)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
state_vs_collisions
```
As we can see, there is not much correlation between average tempurature, maybe we try to see if the annual percipitation affects collisions?

```{r}

ggplot(drivers, aes(x=State, y=`Number of drivers involved in fatal collisions per billion miles`, fill=AverageTemperatureAvgAnnualPrecipitationIn)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))


```
Maybe the states with higher high temperatures have more collisions because the heat is getting to the drivers? 
```{r}
ggplot(drivers, aes(x=State, y=`Number of drivers involved in fatal collisions per billion miles`, fill=AverageTemperatureAvgHighF)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```
```{r}
ggplot(drivers, aes(x=State, y=`Number of drivers involved in fatal collisions per billion miles`, fill=AverageTemperatureAvgLowF)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

```{r}
ggplot(drivers, aes(x= State, y =`Number of drivers involved in fatal collisions per billion miles`, fill = PercentBachelorsOrHigher)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x="State", y="Number of fatal collisions per billion", fill="% of Bachelors or Higher", title = "Fatal Collisions vs. % of Bachelors or Higher Degree")
```


```{r}

ggplot(drivers, aes(x= State, y =`Number of drivers involved in fatal collisions per billion miles`, fill = PercentBachelorsOrHigher)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x="State", y="Number of fatal collisions per billion", fill="% of Bachelors or Higher", title = "Fatal Collisions vs. % of Bachelors or Higher Degree")
```

```{r}

ggplot(drivers, aes(x= State, y =`Number of drivers involved in fatal collisions per billion miles`, fill = PercentHighSchoolOrHigher)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x="State", y="Number of fatal collisions per billion", fill="% of Highschool or Higher", title = "Fatal Collisions vs. % of Highschool or Higher Degree")
```


```{r}
# doesnt work, creation of party col must be missing
average_collision_by_party <- drivers %>%
  group_by(party) %>%
  summarize(average_collision = mean(`Number of drivers involved in fatal collisions per billion miles`))

average_collision_by_party %>%
  ggplot(aes(x = party, y = average_collision, fill = party)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  labs(x = "Political Party", y = "Average Collision") +
  ggtitle("Average Collision by Political Party") +
  scale_fill_manual(values = c("Republican" = "red", "Democrat" = "blue"))
```

```{r}
ggplot(drivers, aes(x= State, y =`Number of drivers involved in fatal collisions per billion miles`, fill = `Percentage Of Drivers Involved In Fatal Collisions Who Were Not Distracted`)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(x="State", y="Number of fatal collisions per billion", fill="% of Non-Distracted Drivers", title = "Fatal Collisions vs. % of Non-Distracted Drivers Fatal Collisions")
```

